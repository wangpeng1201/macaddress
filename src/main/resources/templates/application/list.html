<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Mac后台管理系统</title>
    <!--页面相似度高，引入统一的css，js-->
    <div th:replace="~{home/common.html}"/>
</head>
<body>
<!--顶部   模板引擎， 页面路径 :: id模板名 -->
<header th:replace="home/public :: #publicTop"></header>

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-1 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <div th:replace="home/public :: #publicNav(nav='applications')"></div>
            </div>
        </nav>

        <main role="main" class="col-md-10 ml-sm-auto col-lg-11 pt-3 px-4">
            <div class="layui-form layui-card-header layuiadmin-card-header-auto" style="margin-left: -15px;">
                <form class="layui-form-item layui-form-pane" id="option" lay-filter="option">
                    <div class="layui-inline form-group">
                        <label class="layui-form-label">客户</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" id="customerInput" name="customer" autocomplete="off"
                                   placeholder="请输入客户姓名">
                        </div>
                    </div>
                    <div class="layui-inline form-group">
                        <label class="layui-form-label">申请人</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" id="applicantInput" name="applicant"
                                   autocomplete="off"
                                   placeholder="请输入申请人姓名">
                        </div>
                    </div>
                    <div class="layui-inline form-group">
                        <label class="layui-form-label">申请编号</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" id="applicationIdInput" name="applicationId" autocomplete="off"
                                   placeholder="请输入申请编号">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">申请时间</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input test-item" id="applicationDateInput" name="applicationDate"
                                   autocomplete="off"
                                   placeholder="请选择申请时间">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <button type="button" lay-submit lay-filter="search" class="btn btn-primary"
                                style="margin-bottom: 10px;">
                            搜索
                        </button>
                    </div>
                </form>
                <div>
                    <!-- 按钮触发模态框 -->
                    <button class="btn btn-primary" data-toggle="modal" data-target="#addApplicationModal"
                            style="margin-bottom: 10px;margin-top: -130px;margin-left: 78.5%;">
                        新增申请
                    </button>
                </div>
                <div>
                    <!-- 按钮触发模态框 -->
                    <button class="btn btn-primary" id="deleteBatchBtn" data-type="delete"
                            style="margin-bottom: 10px;margin-top: -215px;margin-left: 85%;">
                        批量删除
                    </button>
                </div>

            </div>

            <table class="layui-hide" id="funcTable" lay-filter="funcTableFilter" lay-size="lg"></table>
            <script type="text/html" id="barOperate">
                <button type="button" class="btn btn-sm btn-info" data-toggle="modal" lay-event="detail"
                        data-target="#myModalDetail">
                    详情
                </button>
                <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" lay-event="edit"
                        data-target="#myModalEdit">
                    编辑
                </button>

<!--                <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" lay-event="delete"-->
<!--                        data-target="#myModalDel" onclick="showDeleteModal(this)">-->
<!--                    删除-->
<!--                </button>-->
                <button type="button" class="btn btn-sm btn-danger" lay-event="delete">
                    删除
                </button>
                <button type="button" class="btn btn-sm btn-warning" lay-event="assignMacAddress">
                    发放
                </button>
                <!--                <button type="button" th:if="${app.status} eq 2" disabled class="btn btn-sm btn-success"-->
                <!--                        onclick="assign(this)">分发-->
                <!--                </button>-->

                <!--<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">-->
                <!--<i class="layui-icon layui-icon-edit" title="edit"></i>-->
                <!--</a>-->
                <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">-->
                <!--<i class="layui-icon layui-icon-delete" title="delete"></i>-->
                <!--</a>-->
            </script>

            <!--分页条-->
            <!--<div th:replace="~{home/pageBar.html}"/>-->
        </main>
    </div>

    <div>
        <!--新增申请模态框-->
        <div class="modal" tabindex="-1" role="dialog" id="addApplicationModal">
            <div class="modal-dialog">
                <div class="modal-content" style="width:650px;height: auto;">
                    <div class="modal-header">
                        <h5 class="modal-title">新增mac地址申请</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!--客户-->
                        <div class="form-group row">
                            <label for="customerAssign"
                                   class="col-sm-2 col-form-label font-weight-bold">客户</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="customerAssign"
                                       name="customerAssign" placeholder="">
                            </div>
                        </div>

                        <!--申请人-->
                        <div class="form-group row">
                            <label for="applicantAssign"
                                   class="col-sm-2 col-form-label font-weight-bold">申请人</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="applicantAssign"
                                       name="applicantAssign" placeholder="">
                            </div>
                        </div>

                        <!--申请人部门-->
                        <div class="form-group row">
                            <label for="applicationDepartmentAssign"
                                   class="col-sm-2 col-form-label font-weight-bold">申请人部门</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="applicationDepartmentAssign"
                                       name="applicationDepartmentAssign" placeholder="">
                            </div>
                        </div>

                        <!--申请数量-->
                        <div class="form-group row">
                            <label for="amountAssign"
                                   class="col-sm-2 col-form-label font-weight-bold">申请数量</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="amountAssign"
                                       name="amountAssign" placeholder="">
                            </div>
                        </div>

                        <!--申请日期-->
<!--                        <div class="form-group row">-->
<!--                            <label for="applicationDateAssign"-->
<!--                                   class="col-sm-2 col-form-label font-weight-bold">申请日期</label>-->
<!--                            <div class="col-sm-10">-->
<!--                                <input type="text" class="form-control input-sm test-item" id="applicationDateAssign"-->
<!--                                       name="applicationDateAssign" placeholder="">-->
<!--                            </div>-->
<!--                        </div>-->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" onclick="submitApplication()">提交</button>
                    </div>
                </div>
            </div>
        </div>

        <!--详情模态框-->
        <div class="modal fade bs-example-modal-lg" id="myModalDetail" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable" style="height: 600px;">
                <div class="modal-content" style="width:800px;height: 750px;">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalDetailLabel">申请详情</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form role="form" id="macDetailForm">
                            <div class="form-group row">
                                <label for="customerDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">客户</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="customerDetail"
                                           name="customerDetail">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="applicantDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">申请人</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicantDetail"
                                           name="applicantDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="applicationDepartmentDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">申请单位</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicationDepartmentDetail"
                                           name="applicationDepartmentDetail">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="amountDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">申请数量</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="amountDetail"
                                           name="amountDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="applicationDateDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">申请日期</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicationDateDetail"
                                           name="applicationDateDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="releaseDateDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">发放日期</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="releaseDateDetail"
                                           name="releaseDateDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="directorDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">费用转嫁承办人工号</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="directorDetail"
                                           name="directorDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="shiftCostNoDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">费用转嫁单号</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="shiftCostNoDetail"
                                           name="shiftCostNoDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="shiftCostDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">转嫁费用金额</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="shiftCostDetail"
                                           name="shiftCostDetail">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="statusDetail"
                                       class="col-sm-2 col-form-label font-weight-bold">申请状态</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="statusDetail"
                                           name="statusDetail">
                                </div>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>

        <!--编辑模态框-->
        <div class="modal fade bs-example-modal-lg" id="myModalEdit" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable" style="height: 600px;">
                <div class="modal-content" style="width:800px;height: 750px;">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalEditLabel">编辑申请</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form role="form" id="macApplicationEditForm">

                            <div class="form-group row" style="display: none">
                                <label for="applicationIdEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">ID</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicationIdEdit"
                                           name="applicationIdEdit">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="customerEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">客户</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="customerEdit"
                                           name="customerEdit">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="applicantEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">申请人</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicantEdit"
                                           name="applicantEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="applicationDepartmentEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">申请单位</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicationDepartmentEdit"
                                           name="applicationDepartmentEdit">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="amountEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">申请数量</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="amountEdit"
                                           name="amountEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="applicationDateEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">申请日期</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="applicationDateEdit"
                                           name="applicationDateEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="releaseDateEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">发放日期</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="releaseDateEdit"
                                           name="releaseDateEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="directorEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">费用转嫁承办人工号</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="directorEdit"
                                           name="directorEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="shiftCostNoEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">费用转嫁单号</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="shiftCostNoEdit"
                                           name="shiftCostNoEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="shiftCostEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">转嫁费用金额</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="shiftCostEdit"
                                           name="shiftCostEdit">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="statusEdit"
                                       class="col-sm-2 col-form-label font-weight-bold">申请状态</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="statusEdit"
                                           name="statusEdit">
                                </div>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="closeBtn">关闭</button>
                        <button type="button" class="btn btn-primary" onclick="editApplication()">提交</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>

        <!--删除模态框-->
        <div th:replace="~{home/deleteModal.html}"/>
    </div>
</div>

<script th:inline="javascript">
    feather.replace();
    layui.use(['form', 'table','layer'], function () {
        let $ = layui.jquery,
            form = layui.form,
            table = layui.table;
        var layer=layui.layer;
        //第一个实例
        //加载表格
        let funcTable = table.render({
            elem: '#funcTable',
            method: 'post',
            where: formData('#option'),
            url: 'applicationBycondition',
            limits: [10, 15, 20, 25, 50, 100],
            limit: 10,
            theme: 'custom',
            page: true,
            sort: true,
            response: {
                statusName: 'code',
                statusCode: 200
            },
            cols: [[ //表头
                {type: 'checkbox', fixed: 'left'},
                {field: 'id', title: '申请编号', width: '7%', sort: true, fixed: 'left', align: 'center'}
                , {field: 'customer', title: '客户', width: '15%', align: 'center'}
                , {field: 'applicant', title: '申请人', width: '10%', align: 'center'}
                , {field: 'applicationDepartment', title: '申请单位', width: '20%', align: 'center'}
                , {field: 'amount', title: '申请数量', width: '10%', align: 'center', sort: true}
                , {
                    field: 'applicationDate',
                    title: '申请日期',
                    width: '10%',
                    sort: true,
                    align: 'center',
                    templet: '<div>{{ layui.util.toDateString(d.applicationDate, "yyyy-MM-dd") }}</div>'
                }
                , {field: 'status', title: '申请状态', width: '8%', sort: true, align: 'center',templet:function (d) {
                        if (d.status =='0'){
                            return '<span class="text-muted">已删除</span>'
                        }else if (d.status =='1'){
                            return '<span class="text-info">新建</span>'
                        }else if (d.status =='2'){
                            return '<span class="text-success">分发成功</span>'
                        }else if (d.status =='3'){
                            return '<span class="text-danger">分发失败</span>'
                        }
                    }}
                , {title: '操作', align: 'center', fixed: 'right', toolbar: '#barOperate'} //操作栏位
            ]],
            done: function (res, curr, count) {
                $('th').css({'font-size': '15', 'font-weight': 'bold', 'text-align': 'center'});
            }
        });

        //监听搜索
        form.on('submit(search)', function (data) {
            let field = data.field;
            console.log("field:", field);
            //执行重载
            funcTable.reload({where: field, page: {curr: 1}});
        });

        /*监听当前行*/
        table.on('row(funcTableFilter)',function (obj){
            // console.log(obj.tr) //得到当前行元素对象
            // console.log(obj.data) //得到当前行数据
        });
        //表格中操作栏位事件监听
        table.on('tool(funcTableFilter)', function (obj) {
            let data = obj.data //当前行的内容
                , layEvent = obj.event; //选中的时间
            console.log(data);
            console.log("layEvent", layEvent);
            if (layEvent === 'detail') {
                console.log(" enter edit...");
                let applicationIdTd=data.id;
                $.ajax({
                    url: "/selectApplication/" + applicationIdTd,
                    type: "GET",
                    method: "GET",
                    success: function (result) {
                        if (result.code == 200) {
                            /*客户*/
                            let customer = result.data.customer;
                            $('#customerDetail').val(customer);
                            /*申请人*/
                            let applicant = result.data.applicant;
                            $('#applicantDetail').val(applicant);
                            /*申请单位*/
                            let applicationDepartment = result.data.applicationDepartment;
                            $('#applicationDepartmentDetail').val(applicationDepartment);
                            /*申请数量*/
                            let amount = result.data.amount;
                            $('#amountDetail').val(amount);
                            /*申请日期*/
                            let applicationDate = result.data.applicationDate;

                            if (applicationDate==null){
                                $('#applicationDateDetail').val();
                            }else{
                                var applicationDateDate = new Date(applicationDate);
                                var applicationDateFormat = applicationDateDate.getFullYear() + '-' + (applicationDateDate.getMonth() + 1) + '-' + applicationDateDate.getDate();
                                $('#applicationDateDetail').val(applicationDateFormat);
                            }

                            /*发放日期*/
                            let releaseDate = result.data.releaseDate;
                            if (releaseDate==null){
                                $('#releaseDateDetail').val();
                            }else{
                                var releaseDateDate = new Date(releaseDate);
                                var releaseDateDetailFormat = releaseDateDate.getFullYear() + '-' + (releaseDateDate.getMonth() + 1) + '-' + releaseDateDate.getDate() + ' ' + releaseDateDate.getHours() + ':' + releaseDateDate.getMinutes() + ':' + releaseDateDate.getSeconds();
                                $('#releaseDateDetail').val(releaseDateDetailFormat);
                            }

                            /*费用转嫁承办人工号*/
                            let director = result.data.director;
                            $('#directorDetail').val(director);
                            /*费用转嫁单号*/
                            let shiftCostNo = result.data.shiftCostNo;
                            $('#shiftCostNoDetail').val(shiftCostNo);
                            /*转嫁费用金额*/
                            let shiftCost = result.data.shiftCost;
                            $('#shiftCostDetail').val(shiftCost);
                            let status = result.data.status;
                            switch (status) {
                                case 1:
                                    status = "新建";
                                    break;
                                case 2:
                                    status = "分发成功";
                                    break;
                                case 3:
                                    status = "分发失败";
                                    break;
                                case 0:
                                    status = "已删除";
                                    break;
                            }
                            $('#statusDetail').val(status);
                        }
                    },
                    error: function () {
                        $('#myModalDetail').modal('hide');  //手动关闭
                        ShowFailure("查看详情失败");
                    }
                });

                // openFunction("Edit People",data.id);
                // window.location.href = ctxPath + 'peopleres/editPeopleRes/' + data.id
            }

            if (layEvent === 'edit') {
                let data = obj.data
                console.error("data:", data);
                console.log(" enter edit...");
                let applicationId = data.id;
                $('#applicationIdEdit').val(applicationId);

                /*客户*/
                let customer = data.customer;
                $('#customerEdit').val(customer);
                /*申请人*/
                let applicant = data.applicant;
                $('#applicantEdit').val(applicant);
                /*申请单位*/
                let applicationDepartment = data.applicationDepartment;
                $('#applicationDepartmentEdit').val(applicationDepartment);
                /*申请数量*/
                let amount = data.amount;
                $('#amountEdit').val(amount);
                /*申请日期*/
                let applicationDate = data.applicationDate;
                if (applicationDate==null){
                    $('#applicationDateEdit').val();
                }else{
                    var applicationDateDate = new Date(applicationDate);
                    var applicationDateFormat = applicationDateDate.getFullYear() + '-' + (applicationDateDate.getMonth() + 1) + '-' + applicationDateDate.getDate();
                    $('#applicationDateEdit').val(applicationDateFormat);
                }
                /*发放日期*/
                let releaseDate = data.releaseDate;
                if (releaseDate==null){
                    $('#releaseDateEdit').val();
                }else{
                    var releaseDateDate = new Date(releaseDate);
                    var releaseDateEditFormat = releaseDateDate.getFullYear() + '-' + (releaseDateDate.getMonth() + 1) + '-' + releaseDateDate.getDate();
                    $('#releaseDateEdit').val(releaseDateEditFormat);
                }

                /*费用转嫁承办人工号*/
                let director = data.director;
                $('#directorEdit').val(director);
                /*费用转嫁单号*/
                let shiftCostNo = data.shiftCostNo;
                $('#shiftCostNoEdit').val(shiftCostNo);
                /*转嫁费用金额*/
                let shiftCost = data.shiftCost;
                $('#shiftCostEdit').val(shiftCost);
                let status = data.status;
                switch (status) {
                    case 1:
                        status = "新建";
                        break;
                    case 2:
                        status = "分发成功";
                        break;
                    case 3:
                        status = "分发失败";
                        break;
                    case 0:
                        status = "已删除";
                        break;
                }
                $('#statusEdit').val(status);

                // openFunction("Edit People",data.id);
                // window.location.href = ctxPath + 'peopleres/editPeopleRes/' + data.id
            }
            if (layEvent === 'delete') {
                console.log("enter delete....");
                layer.confirm("您确认要删除该条信息吗？", {title: "提醒"}, function (index) {
                    $.ajax({
                        type: "post",
                        url: 'application/' + data.id,
                        dataType: "json",
                        success: function (data) {
                            console.log("data:", data);
                            if (data.msg ==='success') {
                                layer.msg('删除成功', {icon: 1});
                            } else {
                                layer.msg(data.msg);
                            }
                            funcTable.reload();
                        }
                    });
                });
            }

            if (layEvent === 'assignMacAddress') {
                console.log(" enter assignMacAddress...");
                let data = obj.data
                console.error("data:", data);
                let applicationIdVal = data.id;
                let customerVal = data.customer;
                let amountVal = data.amount;
                let applicationDepartmentVal = data.applicationDepartment;
                let applicationDateVal = data.applicationDate;
                let applicantVal = data.applicant;
                $.ajax({
                    //请求的url地址
                    url: "/assignMac",
                    //请求是否异步，默认为异步，这也是ajax重要特性
                    async: true,
                    //参数值
                    data: {
                        "id": applicationIdVal,
                        "customer": customerVal,
                        "applicant": applicantVal,
                        "applicationDepartment": applicationDepartmentVal,
                        "amount": amountVal,
                        "applicationDate": applicationDateVal
                    },
                    type: "POST",   //请求方式
                    method: "POST",
                    success: function (req) {
                        console.log(req);
                        //请求成功时处理
                        layer.msg('下发mac地址成功!', {icon: 1});
                        // ShowSuccess("下发mac地址成功!");
                        window.location.href = "/deliveryRecords?pageNum=1";
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        var responseText = JSON.parse(xhr.responseText);
                        let msgTip = responseText.message;
                        layer.msg('下发mac地址失败!'+msgTip, {icon: 2});
                        // ShowFailure("下方mac地址失败！" + msgTip);
                    }
                });

                // openFunction("Edit People",data.id);
                // window.location.href = ctxPath + 'peopleres/editPeopleRes/' + data.id
            }
        });

        //事件 删除
        let active = {
            delete: function () {
                let checkStatus = table.checkStatus('funcTable')
                    , checkData = checkStatus.data; //得到选中的数据
                if (checkData.length === 0) {
                    return layer.msg('未选择任何数据');
                }
                let idArr = [];
                checkData.forEach(elem => {
                    idArr.push(elem.id);
                });
                let ids = idArr.join(",");
                layer.confirm("确认删除【"+ids+"】", {title: "提醒"}, function (index) {
                    //执行 Ajax 后重载
                    $.ajax({
                        type: "post",
                        url: 'delApplication/' + ids,
                        dataType: "json",
                        success: function (data) {
                            if (data.msg === "success") {
                                funcTable.reload();
                                layer.msg("删除成功",{icon: 1});
                            } else {
                                layer.msg(data.msg,{icon:2});
                            }
                            // funcTable.reload();
                            // layer.close(index); //关闭弹层
                        }
                    });
                });
            }
        };
        $('#deleteBatchBtn').on('click', function () {
            let type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });

    /*提交表单*/
    // function addApplication() {
    //     $('#applicationForm').submit();
    //     $('#applicationDateAssign').val();
    //     $('#myModal').modal('hide');  //手动关闭
    //     layer.msg('新增申请成功', {
    //         icon: 1,
    //         time: 3000 //2秒关闭（如果不配置，默认是3秒）
    //     }, function(){
    //         window.location.href('/applications?pageNum=1');
    //     });
    //
    //     // window.location.href('home/list.html');
    //     // window.location.href('/applications?pageNum=1');
    // }

    /*点击日期控件*/
    $(function () {
        layui.use('laydate', function(){
            var laydate = layui.laydate;
            //同时绑定多个
            lay('.test-item').each(function(){
                laydate.render({
                    elem: this
                    ,format:'yyyy-MM-dd'
                    ,trigger: 'click'
                });
            });
        });
        // layui.use('laydate', function(){
        //     var laydate = layui.laydate;
        //
        //     //执行一个laydate实例
        //     laydate.render({
        //         elem: '#applicationDateInput' //指定元素
        //         ,trigger: 'click'
        //     });
        // });
        //
        // layui.use('laydate', function(){
        //     var laydate = layui.laydate;
        //
        //     //执行一个laydate实例
        //     laydate.render({
        //         elem: '#applicationDateAssign' //指定元素
        //     });
        // });

        /*以下为新增模态框日期插件*/
        // $('#applicationDateAssign').datetimepicker({
        //     format: "yyyy-mm-dd",
        //     minView: "month",
        //     autoclose: true,
        //     todayBtn: true,
        //     // locale: moment.locale('zh-cn'),
        //     language: "zh-CN"
        // });
    });

    /*新增mac地址申请*/
    function submitApplication() {
        $('#addApplicationModal').modal('hide');  //手动关闭
        let customerAssignInput = $('#customerAssign').val();
        let applicantAssignInput = $('#applicantAssign').val();
        let applicationDepartmentAssignInput = $('#applicationDepartmentAssign').val();
        let amountAssignInput = $('#amountAssign').val();
        let applicationDateAssignInput = $('#applicationDateAssign').val();
        $.ajax({
            //请求的url地址
            url: "/applications",
            //请求是否异步，默认为异步，这也是ajax重要特性
            async: true,
            //参数值
            data: {
                "customer": customerAssignInput,
                "applicant": applicantAssignInput,
                "applicationDepartment": applicationDepartmentAssignInput,
                "amount": amountAssignInput,
                "applicationDate": applicationDateAssignInput
            },
            type: "POST",   //请求方式
            method: "POST",
            success: function (req) {
                //请求成功时处理
                // ShowSuccess("添加申请成功!");
                // window.location.href = "/applications?pageNum=1";
                //TODO 此处设置时间无效
                layer.msg('新增申请成功', {
                    icon: 1,
                    time: 3000 //2秒关闭（如果不配置，默认是3秒）
                });
                window.location.href = "/applications?pageNum=1";
            },
            error: function () {
                //请求出错处理
                // ShowFailure("添加申请失败");
                layer.msg('新增申请失败', {icon: 2});
            }
        });
    }

    function assign(obj) {
        var applicationTd = $(obj).parent().parent().find("td");
        let macTdTdText = applicationTd.eq(0).text();
        let customerTdText = applicationTd.eq(1).text();
        let applicantTdText = applicationTd.eq(2).text();
        let applicationDepartmentTdText = applicationTd.eq(3).text();
        let applicationAmountTdText = applicationTd.eq(4).text();
        let applicationDateTdText = applicationTd.eq(5).text();
        $.ajax({
            //请求的url地址
            url: "/assignMac",
            //请求是否异步，默认为异步，这也是ajax重要特性
            async: true,
            //参数值
            data: {
                "id": macTdTdText,
                "customer": customerTdText,
                "applicant": applicantTdText,
                "applicationDepartment": applicationDepartmentTdText,
                "amount": applicationAmountTdText,
                "applicationDate": applicationDateTdText
            },
            type: "POST",   //请求方式
            method: "POST",
            success: function (req) {

                //请求成功时处理
                ShowSuccess("客户下方mac地址成功!");
                window.location.href = "/deliveryRecords?pageNum=1";
            },
            error: function (xhr, textStatus, errorThrown) {
                var responseText = JSON.parse(xhr.responseText);
                let msgTip = responseText.message;
                layer.msg('下方mac地址失败！'+msgTip, {icon: 5});
                // ShowFailure("下方mac地址失败！" + msgTip);
            }
        });
    }

    /*点击删除按钮，显示删除确认模态框*/
    let delTr;

    function showDeleteModal(obj) {
        // var delTableTr = obj.parentNode.parentNode;
        // console.log(delTableTr);
        // // tr.parentNode.removeChild(tr);
        // delTr = delTableTr;
        // return delTr;
    }

    function delConfirm() {
        // let applicationIdTd = $(delTr).find("td:eq(0)").text();
        // console.log("applicationIdTd:" + applicationIdTd);
        // $.ajax({
        //     url: "/application/" + applicationIdTd,
        //     type: "post",
        //     method: "post",
        //     success: function (result) {
        //         $('#myModalDel').modal('hide');  //手动关闭
        //         window.location.href = '/applications';
        //     },
        //     error: function () {
        //         $('#myModalDel').modal('hide');  //手动关闭
        //         ShowFailure("删除失败");
        //     }
        // });
    }

    /*编辑模态框下点击提交*/
    function editApplication() {
        let applicationIdEditVal=$('#applicationIdEdit').val();

        /*客户*/
        let customerVal = $('#customerEdit').val();
        /*申请人*/
        let applicantEdit = $('#applicantEdit').val();
        /*申请单位*/
        let applicationDepartmentEdit=$('#applicationDepartmentEdit').val();
        /*申请数量*/
        let amountEdit=$('#amountEdit').val();
        /*申请日期*/
        let applicationDateEdit=$('#applicationDateEdit').val();
        if (applicationDateEdit==null||applicationDateEdit==''){
            applicationDateEdit='';
        }
        /*发放日期*/
        let releaseDateEdit = $('#releaseDateEdit').val();
        if (releaseDateEdit==null||releaseDateEdit==''){
            releaseDateEdit='';
        }
        /*费用转嫁承办人工号*/
        let directorEdit = $('#directorEdit').val();
        /*费用转嫁单号*/
        let shiftCostNoEdit = $('#shiftCostNoEdit').val();
        /*转嫁费用金额*/
        let shiftCostEdit = $('#shiftCostEdit').val();
        let statusEdit = $('#statusEdit').val();
        let statusVal;
        switch (statusEdit) {
            case '新建':
                statusVal = 1;
                break;
            case '分发成功':
                statusVal = 2;
                break;
            case '分发失败':
                statusVal = 3;
                break;
            case '已删除':
                statusVal = 0;
                break;
        }
        $.ajax({
            //请求的url地址
            url: "/editApplication",
            //请求是否异步，默认为异步，这也是ajax重要特性
            async: true,
            //参数值
            data: {
                "id": applicationIdEditVal,
                "customer": customerVal,
                "applicant": applicantEdit,
                "applicationDepartment": applicationDepartmentEdit,
                "amount": amountEdit,
                "applicationDate": applicationDateEdit,
                "releaseDate":releaseDateEdit,
                "director":directorEdit,
                "shiftCostNo":shiftCostNoEdit,
                "shiftCost":shiftCostEdit,
                "status":statusVal
            },
            type: "POST",   //请求方式
            method: "POST",
            dataType: 'json',
            success: function (req) {
                $('#myModalEdit').modal('hide');  //手动关闭
                //请求成功时处理
                ShowSuccess("修改申请成功");
                window.location.href = "/applications?pageNum=1";
            },
            error: function (xhr, textStatus, errorThrown) {
                var responseText = JSON.parse(xhr.responseText);
                let msgTip = responseText.message;
                ShowFailure("修改申请失败！" + msgTip);
            }
        });
    }
</script>
</body>
</html>